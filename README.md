# Отгрузочные таблицы (Autostuffing)

Скрипт на Python для автоматической сборки отгрузочных таблиц по приложениям из папок со счетами (xlsx), с заполнением листа Total (номера счетов, ЭСД, GTD).

---

## Быстрый старт

```bash
git clone https://github.com/YOUR_USERNAME/autostuffing.git
cd autostuffing
```

1. Положите в папку **`templates/`** один файл-шаблон отгрузочной таблицы (`.xlsx` или `.xlsm`).
2. Запустите скрипт — при первом запуске он сам установит зависимости из `requirements.txt`. Укажите рабочую папку (в ней — папки со счетами и/или подпапка `invoices/`):

```bash
python Autostuffing.py
```

Отгрузочные таблицы появятся в указанной папке.

---

## Что делает скрипт

- **Анализирует** папки c инвойсами в указанной директории (или в `invoices/`).
- **Группирует** папки по **приложению** (часть после 3-й запятой) и **породе/товару** (часть после 5 запятой). 
- **Обработка «N pack»** — количество упаковок (13 pack, 16 pack и т.п.) не попадает в имя файла и не создаёт отдельные таблицы. Если «N pack» слито с товаром без запятой (`spr/pine 16 pack`), скрипт убирает суффикс и использует `spr/pine`.
- **Инвойсы:** копирует первый лист каждого xlsx (кроме `invoice N fcs.xlsx`, `invoice N custom.xlsx` и т.п. — файлы с текстом после номера не обрабатываются).
- **Для каждой группы:** копирует шаблон, листы инвойсов (форматирование, 25% масштаб, все столбцы видимы), заполняет лист **Total**: колонка B — номера счетов, J — ЭСД, O — декларации GTD.
- **ЭСД** — только PDF с **ровно 4 дефисами** в имени (например `XXXX-XX-XX-XX-XX.pdf`). Файлы вроде `3486.pdf` не считаются ЭСД.
- **GTD** — PDF вида `GTD_a_b_c.pdf`.

**Имена файлов** по умолчанию — короткие (без диапазона). В конце скрипт предлагает:
- **1** — закрыть без изменения имён;
- **2** — добавить в имена диапазон и количество (например: `(43;93;95-97;100) 6 pcs., ...`).

---

## Структура проекта

```
autostuffing/
├── Autostuffing.py      # основной скрипт
├── requirements.txt     # зависимости (openpyxl)
├── templates/           # сюда — один шаблон .xlsx или .xlsm
└── README.md
```

**Рабочая папка:**
- Папки со счетами (или подпапка `invoices/`) с xlsx-инвойсами и PDF (ЭСД, GTD).
- В неё сохраняются готовые отгрузочные таблицы.

**`path.txt`** — хранит последнюю рабочую папку (можно нажать Enter для повторного использования).

---

## Зависимости

- **Python 3.10+**
- **openpyxl** ≥ 3.1.0

**При первом запуске скрипт сам установит зависимости.**

---

## Настройки (в начале `Autostuffing.py`)

| Переменная            | Назначение                                          |
|-----------------------|-----------------------------------------------------|
| `INVOICE_SUBFOLDER`   | Подпапка со счетами (по умолчанию `invoices`)       |
| `TEMPLATE_SUBFOLDER`  | Папка с шаблоном в корневой папке скрипта           |
| `LAST_PATH_FILE`      | Файл для сохранения последней рабочей папки         |
| `_SHEET_ZOOM_PERCENT` | Масштаб скопированных листов (по умолчанию 25%)     |
| `_ESD_HYPHEN_COUNT`   | Кол-во дефисов в имени ЭСД (4 — только `XXXX-XX-XX-XX-XX.pdf`) |
| `_COL_ESD`, `_COL_GTD`| Колонки на листе Total для ЭСД (J) и деклараций (O) |
